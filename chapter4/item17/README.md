`클래스와 인터페이스 (4장)`

# [ITEM17] 변경 가능성을 최소화하라


----
`Q&A`
## 1.
> 109p. 불변 클래스에도 단점은 있다. 값이 다르면 반드시 독립된 객체로 만들어야 한다는 것이다. 원하는 객체를 완성하기까지의 단계가 많고, 그 중간 단계에서 만들어진 객체들이 모두 버려진다면 성능 문제가 불거진다. 이 문제에 대처하는 방법은 두가지다.
> 첫번째는 흔히 쓰일 *다단계 연산*들을 예측하여 기본 기능으로 제공하는 방법이다.
> 예컨대 BigInteger 는 모듈러 지수 같은 다단계 연산 속도를 높여주는 *가변 동반 클래스*를 package-private 으로 두고 있다.


### [Q]
___
다단계 연산과 가변 동반 클래스란?

### [A]
___
* 가변 동반 클래스
  * 불변 클래스와 거의 동일한 기능을 가지고 있지만 가변적인 클래스를 가변 동반 클래스라고 합니다
  * 가변 동반 클래스는 주로 불변 클래스가 비즈니스 로직 연산 등 시간 복잡도가 높은 연산시 불필요한 클래스 생성을 막기 위해 내부적으로 사용합니다.

  * 예시
    * BigInteger : 불변 클래스 (한번 생성된 후에는 상태가 바뀌지 않는다)
      * 여러 단계에서 걸친 연산이 필요할 때(`=다단계연산`), 불변객체이기 때문에 각 계산 단계마다 새로운 객체들이 계속 생성되어야 하지만
    ,결국 필요한건 마지막 최종 계산 결과를 담고 있는 객체뿐이다!
      * 낭비가 심해짐
      
      * 이런 문제를 해결하기 위해 Java 표준 라이브러리에서 동반 클래스를 제공하고 있고
        
      * 이 경우  MutableBigInteger, SignedMutableBigInteger 가 있다. (거의 같은 기능을 하지만 가변 객체를 생성함)
      * BigInteger 클래스에서 내부적으로 사용하기 때문에 동일한 java.util.math 패키지 안에서 MutableBigInteger, SignedMutableBigInteger  클래스의 접근 제한자를 *package-private* 으로 두고 있는 것!
      
      * 프로그래머들이 직접 이 동반 클래스들을 다루는 것은 매우 어려운 일이지만, 이미 BigInteger 클래스가 동반 클래스들을 적절히 써서 어려운 계산을 하기 때문에, 프로그래머들은 걱정할 필요 없이 BigInteger 클래스만 쓰면 된다 :)

    * String 의 가변 동반 클래스로는 StringBuilder, StringBuffer가 있고, 이 둘은 public final 클래스이다!


___

`내용 정리`

###1. 불변 객체의 장점
  * 불변 객체는 단순하다 : 생성된 시점의 상태를 파괴할 때까지 그대로 간직 
  * 근본적으로 스레드 안전하여 동기화 할 필요가 없다
  * 불변객체는 안심하고 공유 가능
  * 한번 만든 인스턴스 최대한 재활용 가능
  * 불변객체는 자유롭게 공유할 수 있음은 물론, 불변 객체끼리는 내부 데이터를 공유할 수 있다.
  * 객체를 만들때 다른 불변 객체들을 구성요소로 사용하면 이점이 많다 : 맵의 키와 set 의 원소로 쓰기에 좋다

###2. 불변 객체의 단점
 * 다단계 연산시 비용이 크게 필요하다.
      1. 다단계 연산 예측이 된다면, 연산 속도를 높여주는 가변 동반 클래스를 package-private 으로 두기
      2. 예측이 안된다면, 가변 동반 클래스를 public 으로 제공. ex. String & StringBuidler

### 3.불변 클래스를 만드는 설계 방법
 * final 클래스 : 상속을 막는다
 * 정적 팩터리를 제공한다 : 모든 생성자를 private 혹은 package-private 으로 만들고 public 정적 팩터리를 제공한다. 패키지 바깥의 클라이언트에서 바라본 이 
불변 객체는 사실상 final 이다. public , protected 생성자가 없기 때문에 다른 패키지에서는 이 클래스를 확장하는 것이 불가능하기 때문.

### 4. 다른 합당한 이유가 없다면 모든 필드는 private final이어야 한다.